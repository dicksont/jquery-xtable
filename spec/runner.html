<!DOCYTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="/dist/jquery-xtable.css" rel="stylesheet"/>
  <link rel="stylesheet" href="//code.jquery.com/qunit/qunit-1.17.1.css">
  <style>

    body {
      font-family: 'Arial', 'sans-serif';
      font-size: 10pt;
      margin: 0;
      padding: 0;
    }

    form.config {
      background-color: #666;
      color: #fff;
    }

    form.config fieldset {
      border: none;
      margin-right: 18px;
      float: left;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    td {
      border: 1px solid #ddd;
      cursor: pointer;

    }

    ul li {
      list-style-type: none;
      display: inline-block;
    }

    ul li a {

      text-decoration: none;

    }

  </style>
  <script src="/bower_components/qunit/qunit/qunit.js"></script>
  <script>

    location.getParameterByName = function(name) {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");

      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(this.search);

      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    function loadBrowserScripts(scripts) {
      if (!scripts) {
        return;
      } else if (!Array.isArray(scripts)) {
        loadBrowserScripts(new Array(scripts));
      } else if (scripts.length == 0) {
        return;
      } else {
        var script = scripts.shift();
        var scriptel = document.createElement('script');

        scriptel.setAttribute('src', script);
        scriptel.type = "text/javascript";
        scriptel.async = false;

        document.body.appendChild(scriptel);

        loadBrowserScripts(scripts);
      }
    }

    function waitUntil(func, cb) {
      func()? cb() : setTimeout(function() { waitUntil(func, cb) }, waitUntil.step);
    }

    waitUntil.step = 100;

    var $Q = {
      'modenv' :  location.getParameterByName('modenv') || 'browser',
      'tgt' : location.getParameterByName('tgt') || 'table',
    }

    var SPEC_FILES = {
      'quad': 'quad_spec.js',
      'table' : 'table_spec.js'
    }

    window.addEventListener('DOMContentLoaded', function() {
      var selids = [ 'tgt', 'modenv'];

      selids.forEach(function(selid) {
        var elm = document.getElementById(selid);

        elm.value = $Q[selid];

        elm.addEventListener('change', function() {
          document.forms['config'].submit();
        });
      });

      if ($Q['modenv'] == 'amd') {

        loadBrowserScripts('/bower_components/requirejs/require.js');

        waitUntil(function() { return window.hasOwnProperty('requirejs') }, function() {
          requirejs.config({
            urlArgs: Date.now(),
            paths: {
              'jquery' : '/bower_components/jquery/dist/jquery',
              'jquery-xtable-quad' : '/lib/jquery-xtable-quad',
              'jquery-xtable' : '/lib/jquery-xtable',
              'spec' : SPEC_FILES[$Q['tgt']].replace(/\.js$/,''),
            },
            shim: {
              'spec': {
                deps: ['jquery-xtable', 'jquery-xtable-quad'],
              }
            }
          });

          requirejs(['spec']);
        });

      } else {
        loadBrowserScripts([
          "/bower_components/jquery/dist/jquery.js",
          "/lib/jquery-xtable-quad.js",
          "/lib/jquery-xtable.js",
          SPEC_FILES[$Q['tgt']]
        ]);
      }
    });



  </script>
</head>

<body>
  <form class="config" method="get" id="config">
    <fieldset>
      <label>Target Suite</label>
      <select id="tgt" name="tgt">
        <option value="quad">Quad [jQuery.Quad]</option>
        <option value="table">Table [jQuery.table]</option>
      </select>
    </fieldset>
    <fieldset>
      <label>Module Environment</label>
      <select id="modenv" name="modenv">

        <option value="browser">Plain Browser</option>
        <option value="amd">AMD [e.g. Require.js]</option>
      </select>
    </fieldset>
    <div style="clear: left"></div>
  </form>

  <div id="qunit"></div>
  <div id="qunit-fixture">
    <table class="buster">
      <tr>
        <th>Age</th>
        <th>Games</th>
        <th>Batting Average</th>
        <th>Home Runs</th>
      </tr>
      <tr>
        <td class="selected">24</td>
        <td>45</td>
        <td>.284</td>
        <td>4</td>
      </tr>
      <tr>
        <td>25</td>
        <td>148</td>
        <td>.336</td>
        <td>24</td>
      </tr>
      <tr>
        <td>26</td>
        <td>148</td>
        <td>.294</td>
        <td>15</td>
      </tr>
      <tr>
        <td>27</td>
        <td>147</td>
        <td>.311</td>
        <td>22</td>
      </tr>
    </table>
    <table class="b">
      <tr>
        <th></th>
        <th>A</th>
        <th>B</th>
        <th>C</th>
      </tr>
      <tr>
        <th>1</th>
        <td rowspan="2" colspan="2">A1</td>
        <td>C1</td>
        <td>D1</td>
      </tr>
      <tr>
        <th>2</th>
        <td>C2</td>
        <td rowspan="2">D2</td>
      </tr>
      <tr>
        <th>3</th>
        <td>A3</td>
        <td>B3</td>
        <td>C3</td>
      </tr>
      <tr>
        <th>4</th>
        <td>A4</td>
        <td>B4</td>
        <td>C4</td>
        <td>D4</td>
      </tr>
    </table>
  </div>
</body>
</html>
